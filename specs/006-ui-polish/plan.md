# Implementation Plan: UI Polish Pack

**Branch**: `006-ui-polish` | **Date**: 2025-11-28 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/006-ui-polish/spec.md`

## Summary

This feature adds seven quick-win UX enhancements to improve the document viewer's polish and usability for hackathon demo. All features are frontend-only with no backend changes required. Implementation uses existing patterns (CSS variables, tailwindcss-animate, React hooks, shadcn/ui components) to minimize complexity and maintain consistency.

**Primary Requirements**:
- P1: Font size adjuster (3 sizes: small/medium/large)
- P1: Expand/collapse all folders in directory tree
- P2: Wikilink preview tooltips on hover
- P2: Reading time estimator badge
- P2: Table of contents flyout panel
- P3: Smooth transitions/animations
- STRETCH: Particle click effects

**Technical Approach**: Leverage existing architecture (CSS custom properties for font sizing, state propagation for tree expansion, HoverCard for previews, ResizablePanel for TOC, tailwindcss-animate for transitions). Zero backend changes, minimal new dependencies.

## Technical Context

**Language/Version**: TypeScript 5.x, React 18+
**Primary Dependencies**:
- React 18, TypeScript, Vite (existing)
- Tailwind CSS + tailwindcss-animate (existing)
- shadcn/ui components (existing)
- react-markdown + remark-gfm (existing)
- NEW: @radix-ui/react-hover-card (for wikilink previews)

**Storage**: localStorage for user preferences (font size, TOC panel state)
**Testing**: Manual verification + browser console (no automated tests for UI polish)
**Target Platform**: Modern browsers (Chrome 90+, Firefox 88+, Safari 14+, Edge 90+)
**Project Type**: Web (frontend-only changes)
**Performance Goals**:
- Font size change: < 100ms
- Expand All (100 folders): < 2s
- Wikilink preview fetch: < 600ms total (500ms delay + 100ms fetch)
- TOC generation: < 500ms for 50 headings
- All animations: 60 FPS (no dropped frames)

**Constraints**:
- WCAG 2.2 Level AA compliance
- No backend API changes
- No new data models or database changes
- Respect prefers-reduced-motion media query
- Mobile-friendly (responsive design)

**Scale/Scope**:
- 7 features (6 core + 1 stretch)
- 18 functional requirements
- Est. 4-6 hours implementation

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. Brownfield Integration ✅ PASS

**Assessment**: All features leverage existing patterns and components. No rewrites or refactors required.

**Evidence**:
- Font sizing uses existing CSS custom properties pattern (`index.css:6-50`)
- Tree expansion extends existing DirectoryTree component (`DirectoryTree.tsx`)
- Tooltips use shadcn/ui (existing component library)
- TOC uses existing ResizablePanel pattern (`MainApp.tsx:583-778`)
- Transitions use existing tailwindcss-animate (`tailwind.config.js:57-97`)
- Reading time uses existing markdownToPlainText (`markdownToText.ts`)

### II. Test-Backed Development ⚠️ PARTIAL

**Assessment**: Frontend UI polish features rely on manual verification. No automated tests required per constitution ("UI components rely on manual verification/E2E").

**Evidence**:
- Spec includes detailed acceptance scenarios for manual testing
- No backend changes = no pytest requirements
- Frontend E2E tests not in scope for polish features
- Regression: Existing tests unaffected (no changes to tested code paths)

### III. Incremental Delivery ✅ PASS

**Assessment**: Features are independently testable and can be implemented/deployed incrementally.

**Evidence**:
- Spec prioritizes features (P1, P2, P3, STRETCH)
- Each feature in separate component/file
- No interdependencies between features
- Can ship P1 features first, P2/P3 later

### IV. Specification-Driven ✅ PASS

**Assessment**: All work traces back to spec.md with clear functional requirements.

**Evidence**:
- 18 functional requirements (FR-001 through FR-018)
- Each feature has acceptance scenarios
- Success criteria defined
- No ghost features planned

**RESULT**: ✅ **APPROVED FOR IMPLEMENTATION** - All gates pass or justified

## Project Structure

### Documentation (this feature)

```text
specs/006-ui-polish/
├── spec.md               # Feature specification
├── plan.md               # This file
├── research.md           # Technology decisions and best practices
├── checklists/
│   └── requirements.md   # Spec quality validation
└── tasks.md              # Will be generated by /speckit.tasks
```

### Source Code (repository root)

```text
frontend/
├── src/
│   ├── components/
│   │   ├── DirectoryTree.tsx          # Modified: add expand/collapse all
│   │   ├── NoteViewer.tsx             # Modified: add font controls, reading time, TOC button
│   │   ├── TableOfContents.tsx        # NEW: TOC panel component
│   │   └── ui/
│   │       ├── hover-card.tsx         # NEW: shadcn component (via CLI)
│   │       └── slider.tsx             # Existing: used for font size
│   ├── pages/
│   │   └── MainApp.tsx                # Modified: font size state, smooth transitions
│   ├── lib/
│   │   ├── markdown.tsx               # Modified: add heading IDs, wikilink HoverCard
│   │   └── markdownToText.ts          # Existing: used for reading time
│   ├── hooks/
│   │   ├── useFontSize.ts             # NEW: font size preference hook
│   │   └── useTableOfContents.ts      # NEW: TOC extraction hook
│   └── index.css                      # Modified: add --content-font-size variable
└── tailwind.config.js                 # Modified: extend transition utilities

backend/
└── [NO CHANGES]

data/
└── [NO CHANGES]
```

**Structure Decision**: Web application (Option 2) - Frontend-only changes. All modifications confined to `frontend/src/`. No backend, API, or database changes required.

## Complexity Tracking

**No violations to justify** - All constitution gates pass.

## Phase 0: Research (COMPLETE)

**Output**: `research.md` - See [research.md](./research.md)

**Key Decisions**:
1. **Font Size**: CSS custom properties scoped to `.prose` (WCAG compliant)
2. **Expand/Collapse**: State propagation via `forceExpandState` prop
3. **Wikilink Previews**: shadcn HoverCard with 500ms delay + cache
4. **TOC**: Custom react-markdown renderer + ResizablePanel
5. **Transitions**: tailwindcss-animate (existing)
6. **Reading Time**: markdownToPlainText + 200 WPM
7. **Particles**: CSS-only or shadcn component (stretch)

**Resolved Clarifications**: None - all technical approaches clear from research.

## Phase 1: Design & Contracts

### Data Model

**File**: `data-model.md`

**Entities**:

1. **FontSizePreference** (localStorage)
   - Key: `note-font-size`
   - Value: `"small"` | `"medium"` | `"large"`
   - Scope: Global (applies to all notes)

2. **TOCPanelState** (localStorage)
   - Key: `toc-panel-open`
   - Value: `boolean`
   - Scope: Global (persists across sessions)

3. **WikilinkPreviewCache** (React state)
   - Type: `Map<string, string>` (path → preview text)
   - Lifecycle: Component mount (cleared on unmount)
   - Purpose: Avoid re-fetching previews

4. **TOCHeading** (computed)
   - Fields: `{ id: string, text: string, level: 1|2|3 }`
   - Source: Extracted from markdown during render
   - Lifecycle: Re-computed when note.body changes

**No backend data models** - All state is client-side.

### API Contracts

**No new API endpoints** - Features use existing endpoints:

- `GET /api/notes/{path}` - Fetch note for wikilink preview (existing)
- All other features are pure frontend (no API calls)

### Component Contracts

**New Components**:

1. **TableOfContents.tsx**
```typescript
interface TableOfContentsProps {
  headings: TOCHeading[];
  isOpen: boolean;
  onToggle: () => void;
  onHeadingClick: (id: string) => void;
}
```

2. **useFontSize.ts**
```typescript
interface UseFontSizeReturn {
  fontSize: "small" | "medium" | "large";
  setFontSize: (size: "small" | "medium" | "large") => void;
  fontSizeRem: number; // 0.875 | 1 | 1.125
}
```

3. **useTableOfContents.ts**
```typescript
interface UseTableOfContentsReturn {
  headings: TOCHeading[];
  isOpen: boolean;
  toggleTOC: () => void;
  scrollToHeading: (id: string) => void;
}
```

**Modified Components**:

1. **DirectoryTree.tsx**
```typescript
// Add props:
interface DirectoryTreeProps {
  // ... existing props
  expandAll?: boolean; // Trigger expand all
  collapseAll?: boolean; // Trigger collapse all
}
```

2. **NoteViewer.tsx**
```typescript
// Add props:
interface NoteViewerProps {
  // ... existing props
  fontSize?: "small" | "medium" | "large";
  onFontSizeChange?: (size: "small" | "medium" | "large") => void;
}
```

### Quick Start Guide

**File**: `quickstart.md`

**Development Setup**:
```bash
# 1. Switch to feature branch
git checkout 006-ui-polish

# 2. Install new shadcn component
cd frontend
npx shadcn@latest add hover-card

# 3. Start dev server
npm run dev

# 4. Test in browser at http://localhost:5173
```

**Testing Checklist**:
- [ ] Font size: Click A-, A, A+ buttons and verify text resizes
- [ ] Font persistence: Reload page and verify size retained
- [ ] Expand All: Click and verify all folders open
- [ ] Collapse All: Click and verify all folders close
- [ ] Wikilink preview: Hover over `[[link]]` for 500ms, see tooltip
- [ ] Reading time: Open long note, see "X min read" badge
- [ ] TOC: Open long note, click TOC button, see headings panel
- [ ] TOC scroll: Click heading in TOC, verify smooth scroll
- [ ] Transitions: Switch notes, verify fade-in animation
- [ ] Accessibility: Tab through controls, verify keyboard nav
- [ ] Mobile: Test on small screen, verify responsive

**Deployment**:
```bash
# Build production bundle
npm run build

# Verify build output
ls -lh dist/

# Deploy (HuggingFace Space auto-deploys on git push)
git push origin 006-ui-polish
```

## Constitution Re-Check (Post-Design)

All gates remain **PASS** after design phase:

- ✅ Brownfield: No existing code rewritten
- ✅ Testing: Manual verification per constitution
- ✅ Incremental: Features independently deployable
- ✅ Spec-driven: All work traces to FR-001 through FR-018

**No new violations introduced.**

## Technology Additions

**New Dependencies**:
- `@radix-ui/react-hover-card` (via shadcn CLI)

**Optional (Stretch)**:
- shadcn particles component (if particle effects implemented)

## Next Steps

1. Run `/speckit.tasks` to generate implementation task list
2. Implement features in priority order (P1 → P2 → P3 → STRETCH)
3. Manual testing per quickstart.md checklist
4. Merge to master when P1+P2 features complete (P3+STRETCH optional)

## Files Generated

- ✅ `research.md` - Technology decisions and best practices
- ✅ `data-model.md` - Client-side data structures
- ✅ `quickstart.md` - Development and testing guide
- ⏳ `contracts/` - N/A (no API contracts, component contracts in plan.md)
- ⏳ `tasks.md` - To be generated by `/speckit.tasks`

---

**Plan Status**: ✅ COMPLETE - Ready for `/speckit.tasks`
